<!-- データ突合画面 -->
<div id="dataMatchingPage" class="data-matching-page">
    <div class="page-header">
        <div class="header-left">
            <button class="back-btn" onclick="handleBackFromDataMatching()">
                <span class="back-arrow">←</span> 戻る
            </button>
            <h1 class="page-title">データ突合</h1>
        </div>
        <div class="header-right">
            <button class="open-sub-window-btn" onclick="openLedgerSubWindow()">
                <span class="icon">🗗</span> 資産台帳を別窓で開く
            </button>
        </div>
    </div>

    <!-- 進捗状況 -->
    <div class="progress-bar-container">
        <div class="progress-info">
            <span class="progress-label">進捗状況:</span>
            <span class="progress-value" id="matchingProgressText">確定済 0/150件 | 未処理 150件</span>
        </div>
    </div>

    <!-- フィルターパネル -->
    <div class="filter-panel-matching">
        <div class="filter-row">
            <div class="filter-group">
                <label>ステータス</label>
                <select id="filterStatus" class="filter-select" onchange="applyMatchingFilters()">
                    <option value="all">全て</option>
                    <option value="pending">未処理</option>
                    <option value="completed">確定済</option>
                    <option value="review">要確認</option>
                    <option value="mismatch">不一致</option>
                </select>
            </div>

            <div class="filter-group">
                <label>部署</label>
                <select id="filterDepartmentMatching" class="filter-select" onchange="applyMatchingFilters()">
                    <option value="">全て</option>
                    <option value="手術部門">手術部門</option>
                    <option value="放射線科">放射線科</option>
                    <option value="検査科">検査科</option>
                    <option value="病理科">病理科</option>
                    <option value="外来">外来</option>
                </select>
            </div>

            <div class="filter-group">
                <label>品目</label>
                <select id="filterItemMatching" class="filter-select" onchange="applyMatchingFilters()">
                    <option value="">全て</option>
                    <option value="電気メス">電気メス</option>
                    <option value="CT装置">CT装置</option>
                    <option value="MRI装置">MRI装置</option>
                    <option value="血液分析装置">血液分析装置</option>
                    <option value="顕微鏡">顕微鏡</option>
                    <option value="診察台">診察台</option>
                </select>
            </div>

            <div class="filter-group">
                <label>メーカー</label>
                <select id="filterMakerMatching" class="filter-select" onchange="applyMatchingFilters()">
                    <option value="">全て</option>
                    <option value="オリンパス">オリンパス</option>
                    <option value="GEヘルスケア">GEヘルスケア</option>
                    <option value="シーメンス">シーメンス</option>
                    <option value="シスメックス">シスメックス</option>
                    <option value="ニコン">ニコン</option>
                </select>
            </div>

            <div class="filter-group">
                <input type="text" id="searchKeywordMatching" class="search-input" placeholder="キーワード検索..." onkeyup="applyMatchingFilters()">
            </div>

            <button class="reset-filter-btn" onclick="resetMatchingFilters()">フィルター解除</button>
        </div>

        <div class="action-row">
            <button class="action-btn" onclick="bulkConfirmMatching()">
                <span class="icon">✓</span> 選択項目を一括確定
            </button>
        </div>
    </div>

    <!-- メインテーブル: 現有品調査リスト -->
    <div class="main-table-container">
        <div class="table-header-bar">
            <h2 class="table-title">現有品調査リスト</h2>
            <div class="table-count">
                <span id="surveyListCount">表示: 150件</span>
            </div>
        </div>

        <div class="table-scroll-container">
            <table class="resizable-table data-matching-table">
                <thead>
                    <tr>
                        <th class="th-checkbox">
                            <input type="checkbox" id="selectAllSurvey" onchange="toggleSelectAllSurvey(this)">
                        </th>
                        <th class="th-status">突合状態</th>
                        <th class="th-seal-no">シールNo</th>
                        <th class="th-asset-no">資産番号</th>
                        <th class="th-department">部署</th>
                        <th class="th-item">品目</th>
                        <th class="th-maker">メーカー</th>
                        <th class="th-model">型式</th>
                        <th class="th-quantity">数量</th>
                        <th class="th-purchase-date">購入日</th>
                        <th class="th-actions">操作</th>
                    </tr>
                </thead>
                <tbody id="surveyTableBody">
                    <!-- データはJSで生成 -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- 資産台帳選択モーダル -->
<div id="ledgerSelectModal" class="modal-overlay">
    <div class="modal-container ledger-select-modal">
        <div class="modal-header">
            <h3>資産台帳から選択</h3>
            <button class="modal-close-btn" onclick="closeLedgerSelectModal()">×</button>
        </div>
        <div class="modal-body">
            <div class="ledger-search-bar">
                <input type="text" id="ledgerSearchInput" class="search-input" placeholder="資産番号、品目、メーカーで検索..." onkeyup="filterLedgerModal()">
            </div>
            <div class="ledger-table-container">
                <table class="resizable-table ledger-select-table">
                    <thead>
                        <tr>
                            <th>選択</th>
                            <th>突合</th>
                            <th>資産番号</th>
                            <th>部署</th>
                            <th>品目</th>
                            <th>メーカー</th>
                            <th>型式</th>
                            <th>購入日</th>
                        </tr>
                    </thead>
                    <tbody id="ledgerModalTableBody">
                        <!-- データはJSで生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" onclick="confirmLedgerSelection()">この資産と紐付ける</button>
            <button class="btn-secondary" onclick="closeLedgerSelectModal()">キャンセル</button>
        </div>
    </div>
</div>
