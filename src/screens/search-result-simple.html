<!-- è³‡ç”£æ¤œç´¢çµæœç”»é¢ - å®Œå…¨ç‰ˆ -->
<div id="searchResultPage" class="search-result-page">

    <div class="result-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="result-header">
            <div class="result-header-left">
                <div class="logo">
                    <div class="logo-icon">SHIP</div>
                    <div class="result-header-title">è³‡ç”£ãƒªã‚¹ãƒˆ</div>
                </div>
                <span class="result-count">20ä»¶ï¼ˆåŸæœ¬ï¼‰</span>
            </div>
            <div class="result-header-actions">
                <div class="nav-menu">
                    <button class="nav-menu-btn" onclick="toggleNavMenu()">
                        <span>ğŸ“‘ ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                        <span class="nav-menu-arrow">â–¼</span>
                    </button>
                    <div class="nav-menu-dropdown" id="navMenuDropdown">
                        <div class="nav-menu-item" onclick="goToApplicationList()">
                            <span class="nav-menu-item-icon">ğŸ“</span>
                            <span>ç”³è«‹ä¸€è¦§</span>
                        </div>
                        <div class="nav-menu-item" onclick="goToExecutionPendingList()">
                            <span class="nav-menu-item-icon">â³</span>
                            <span>åŸ·è¡Œå¾…ã¡ä¸€è¦§</span>
                        </div>
                        <div class="nav-menu-item" onclick="goToQuoteOCR()">
                            <span class="nav-menu-item-icon">ğŸ¤–</span>
                            <span>è¦‹ç©æ›¸AI-OCR</span>
                        </div>
                    </div>
                </div>
                <button class="header-icon-btn" id="viewToggleBtn" onclick="toggleView()" title="è¡¨ç¤ºåˆ‡æ›¿">
                    ğŸ“‹
                </button>
                <button class="header-icon-btn" onclick="toggleSidePanel()" title="è¡Œè¡¨ç¤ºé …ç›®é¸æŠ">
                    âš™ï¸
                </button>
                <button class="header-icon-btn" id="exportBtn" onclick="handleExport()" title="Excel/PDFå‡ºåŠ›">
                    ğŸ“Š
                </button>
                <button class="header-icon-btn" onclick="handlePrint()" title="å°åˆ·">
                    ğŸ–¨ï¸
                </button>
                <button class="header-btn back" onclick="handleBack()">æˆ»ã‚‹</button>
            </div>
        </header>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="filter-header">
            <div class="filter-row-single">
                <div class="filter-group">
                    <label>æ£Ÿ</label>
                    <select id="filterBuilding" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="æœ¬é¤¨">æœ¬é¤¨</option>
                        <option value="åˆ¥é¤¨">åˆ¥é¤¨</option>
                        <option value="æ–°é¤¨">æ–°é¤¨</option>
                        <option value="ç ”ç©¶æ£Ÿ">ç ”ç©¶æ£Ÿ</option>
                        <option value="ç®¡ç†æ£Ÿ">ç®¡ç†æ£Ÿ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>éš</label>
                    <select id="filterFloor" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="B1F">B1F</option>
                        <option value="1F">1F</option>
                        <option value="2F">2F</option>
                        <option value="3F">3F</option>
                        <option value="4F">4F</option>
                        <option value="5F">5F</option>
                        <option value="6F">6F</option>
                        <option value="7F">7F</option>
                        <option value="8F">8F</option>
                        <option value="9F">9F</option>
                        <option value="10F">10F</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>éƒ¨é–€</label>
                    <select id="filterDepartment" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>éƒ¨ç½²</label>
                    <select id="filterSection" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category</label>
                    <select id="filterCategory" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="åŒ»ç™‚æ©Ÿå™¨">åŒ»ç™‚æ©Ÿå™¨</option>
                        <option value="ä»€å™¨å‚™å“">ä»€å™¨å‚™å“</option>
                        <option value="è»Šä¸¡">è»Šä¸¡</option>
                        <option value="å»ºç‰©">å»ºç‰©</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>å¤§åˆ†é¡</label>
                    <select id="filterLargeClass" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ä¸­åˆ†é¡</label>
                    <select id="filterMediumClass" class="filter-select">
                        <option value="">ã™ã¹ã¦</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
        <div class="action-bar">
            <span class="selection-info" id="selectionInfo">0ä»¶é¸æŠä¸­</span>

            <!-- æ–°è¦è³¼å…¥ç”³è«‹ï¼ˆè³‡ç”£ãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠï¼‰ -->
            <button class="action-btn new-purchase-action" onclick="handleNewPurchaseRequest()">
                æ–°è¦è³¼å…¥ç”³è«‹
            </button>

            <!-- æ—¢å­˜è³‡ç”£ãƒ™ãƒ¼ã‚¹ã®ç”³è«‹ï¼ˆè³‡ç”£é¸æŠå¿…é ˆï¼‰ -->
            <button class="action-btn expansion-action" id="expansionBtn" onclick="handleExpansionRequest()" disabled>
                å¢—è¨­è³¼å…¥ç”³è«‹
            </button>

            <button class="action-btn renewal-action" id="renewalBtn" onclick="handleRenewalRequest()" disabled>
                æ›´æ–°è³¼å…¥ç”³è«‹
            </button>

            <button class="action-btn move-action" id="moveBtn" onclick="handleMoveRequest()" disabled>
                ç§»å‹•ç”³è«‹
            </button>

            <button class="action-btn disposal-action" id="disposalBtn" onclick="handleDisposalRequest()" disabled>
                å»ƒæ£„ç”³è«‹
            </button>

            <button class="action-btn hold-action" id="holdBtn" onclick="handleHoldRequest()" disabled>
                ä¿ç•™ç”³è«‹
            </button>

            <!-- ãã®ä»–ã®æ©Ÿèƒ½ -->
            <button class="action-btn inventory-action" id="inventoryBtn" onclick="handleInventory()" disabled>
                è³‡ç”£æ£šå¸ã—
            </button>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="main-content-area">
            <div class="content-wrapper">
                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º -->
                <div class="list-view" id="listView">
                    <table class="resizable-table data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll" onchange="handleSelectAll()"></th>
                                <th>No.</th>
                                <th>æ–½è¨­å</th>
                                <th>æ£Ÿ</th>
                                <th>éš</th>
                                <th>éƒ¨é–€</th>
                                <th>éƒ¨ç½²</th>
                                <th>Category</th>
                                <th>å¤§åˆ†é¡</th>
                                <th>ä¸­åˆ†é¡</th>
                                <th>å“ç›®</th>
                                <th>å“å</th>
                                <th>ãƒ¡ãƒ¼ã‚«ãƒ¼</th>
                                <th>å‹å¼</th>
                                <th>æ•°é‡</th>
                                <th>å¹…(W)</th>
                                <th>å¥¥è¡Œ(D)</th>
                                <th>é«˜ã•(H)</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- ãƒ‡ãƒ¼ã‚¿è¡Œã¯JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
                <div class="card-view" id="cardView">
                    <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Excel/PDFå‡ºåŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="exportModal" onclick="handleExportModalOutsideClick(event)">
        <div class="modal-content">
            <h2 class="modal-title" id="exportModalTitle">Excelå‡ºåŠ›é …ç›®ã®é¸æŠ</h2>
            <div class="modal-option" onclick="selectExportTemplate('default')">
                <div class="modal-option-label">å‡ºåŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</div>
                <div class="modal-option-desc">ç™»éŒ²æ¸ˆã®å‡ºåŠ›é …ç›®ã‚’é¸æŠ</div>
            </div>
            <div class="modal-option" onclick="selectExportTemplate('bookmark')">
                <div class="modal-option-label">ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</div>
                <div class="modal-option-desc">ä»»æ„ã®ç™»éŒ²æ¸ˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</div>
            </div>
            <button class="modal-button" onclick="executeExport()">ã“ã®æ¡ä»¶ã§Excelå‡ºåŠ›</button>
            <button class="modal-button secondary" onclick="selectCustomColumns()">ä»»æ„é …ç›®é¸æŠ</button>
            <button class="modal-button secondary" onclick="closeExportModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <!-- è³‡ç”£ãƒã‚¹ã‚¿æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ–°è¦è³¼å…¥ç”¨ï¼‰ -->
    <div class="modal" id="assetMasterModal" onclick="handleModalOutsideClick(event)">
        <div class="modal-content">
            <h2 class="modal-title">è³‡ç”£ãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠï¼ˆæ–°è¦è³¼å…¥ç”³è«‹ï¼‰</h2>

            <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div style="margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 4px;">
                <h4 style="font-size: 13px; color: #2c3e50; margin-bottom: 10px; font-weight: bold;">ğŸ“‹ ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ¤œç´¢</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div id="categoryWrapper" style="position: relative; z-index: 100008;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">Category</label>
                        <select id="masterCategory" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div id="largeClassWrapper" style="position: relative; z-index: 100007;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">å¤§åˆ†é¡</label>
                        <select id="masterLargeClass" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div id="mediumClassWrapper" style="position: relative; z-index: 100006;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">ä¸­åˆ†é¡</label>
                        <select id="masterMediumClass" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div id="individualItemWrapper" style="position: relative; z-index: 100005;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">å€‹ä½“ç®¡ç†å“ç›®</label>
                        <select id="masterIndividualItem" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div id="makerWrapper" style="position: relative; z-index: 100004;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">ãƒ¡ãƒ¼ã‚«ãƒ¼</label>
                        <select id="masterMaker" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div id="modelWrapper" style="position: relative; z-index: 100003;">
                        <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">å‹å¼</label>
                        <select id="masterModel" class="master-filter-select" onchange="filterAssetMasterTable()">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="modal-button secondary" onclick="resetMasterFilter()" style="flex: 1;">
                        ğŸ”„ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>

            <!-- è³‡ç”£ãƒã‚¹ã‚¿ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 14px; color: #2c3e50; margin-bottom: 10px;">
                    æ¤œç´¢çµæœ
                    <span id="assetMasterResultCount" style="color: #3498db; font-weight: bold;">0ä»¶</span>
                </h3>
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
                    <table id="assetMasterTable" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead style="position: sticky; top: 0; background: #f8f9fa; z-index: 10;">
                            <tr>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left; width: 50px;">
                                    <input type="checkbox" id="selectAllMaster" onchange="handleSelectAllMaster()">
                                </th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">Category</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">å¤§åˆ†é¡</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">ä¸­åˆ†é¡</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">å“ç›®</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">ãƒ¡ãƒ¼ã‚«ãƒ¼</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: left;">å‹å¼</th>
                            </tr>
                        </thead>
                        <tbody id="assetMasterTableBody">
                            <tr>
                                <td colspan="7" style="padding: 20px; text-align: center; color: #999;">
                                    æ¤œç´¢æ¡ä»¶ã‚’æŒ‡å®šã—ã¦æ¤œç´¢ã—ã¦ãã ã•ã„
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- é¸æŠæ¸ˆã¿è³‡ç”£ãƒªã‚¹ãƒˆ -->
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 14px; color: #2c3e50; margin-bottom: 10px;">
                    é¸æŠæ¸ˆã¿è³‡ç”£
                    <span id="masterSelectionInfo" style="color: #27ae60; font-weight: bold;">0ä»¶é¸æŠä¸­</span>
                </h3>
                <div id="selectedAssetsList" style="min-height: 80px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #f9f9f9;">
                    <p style="color: #999; text-align: center;">è³‡ç”£ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="modal-button secondary" onclick="closeAssetMasterModal()" style="flex: 1;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-button" onclick="proceedToApplicationInput()" style="flex: 2; background: #27ae60; color: white;">ç”³è«‹å…¥åŠ›ã¸é€²ã‚€ â†’</button>
            </div>
        </div>
    </div>

    <!-- ç”³è«‹å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆ2æ®µéšç›®ï¼‰ -->
    <div class="application-input-modal" id="applicationInputModal" onclick="handleApplicationInputModalOutsideClick(event)">
        <div class="application-input-content" onclick="event.stopPropagation()">
            <div class="application-input-header">
                <h2>
                    <span id="applicationTypeTitle">æ–°è¦è³¼å…¥ç”³è«‹</span>
                </h2>
                <button class="modal-close" onclick="closeApplicationInputModal()">Ã—</button>
            </div>
            
            <div class="application-input-body">
                <!-- ç”³è«‹åŸºæœ¬æƒ…å ± -->
                <div class="application-section">
                    <div class="application-section-title">ğŸ“‹ ç”³è«‹åŸºæœ¬æƒ…å ±</div>
                    <div class="application-form-group">
                        <label>ç”³è«‹ç¨®åˆ¥</label>
                        <input type="text" id="appType" value="æ–°è¦è³¼å…¥ç”³è«‹" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="application-form-group">
                        <label>ç”³è«‹æ—¥</label>
                        <input type="text" id="appDate" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="application-form-group">
                        <label>ç”³è«‹è€…</label>
                        <input type="text" id="appUser" value="å±±ç”°å¤ªéƒ" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="application-form-group">
                        <label>ç”³è«‹ç†ç”± <span class="required">*</span></label>
                        <textarea id="appReason" placeholder="ç”³è«‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                    </div>
                </div>
                
                <!-- å¯¾è±¡è³‡ç”£æƒ…å ± -->
                <div class="application-section">
                    <div class="application-section-title">ğŸ¥ å¯¾è±¡è³‡ç”£æƒ…å ±</div>
                    <div id="selectedAssetsDisplay">
                        <!-- é¸æŠã•ã‚ŒãŸè³‡ç”£ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <!-- è¦‹ç©æ›¸æƒ…å ± -->
                <div class="application-section">
                    <div class="application-section-title">ğŸ’° è¦‹ç©æ›¸æƒ…å ±</div>
                    <div class="quotation-list" id="quotationList">
                        <!-- è¦‹ç©æ›¸ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                    </div>
                    <button class="add-quotation-btn" onclick="addQuotationForm()">
                        <span>+</span>
                        <span>è¦‹ç©æ›¸ã‚’è¿½åŠ </span>
                    </button>
                </div>
                
                <!-- æ‰¿èªãƒ•ãƒ­ãƒ¼ -->
                <div class="application-section">
                    <div class="application-section-title">âœ… æ‰¿èªãƒ•ãƒ­ãƒ¼</div>
                    <div class="approval-flow">
                        <div class="application-form-group">
                            <label>1æ¬¡æ‰¿èªè€… <span class="required">*</span></label>
                            <select id="approver1">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="suzuki">åŒ»ç™‚æ©Ÿå™¨æ‹…å½“ éˆ´æœ¨</option>
                                <option value="tanaka">åŒ»ç™‚äº‹å‹™èª²é•· ç”°ä¸­</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>2æ¬¡æ‰¿èªè€… <span class="required">*</span></label>
                            <select id="approver2">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="sato">åŒ»ç™‚äº‹å‹™éƒ¨é•· ä½è—¤</option>
                                <option value="yamamoto">ç·å‹™éƒ¨é•· å±±æœ¬</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>æœ€çµ‚æ‰¿èªè€… <span class="required">*</span></label>
                            <select id="approver3">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="director">ç—…é™¢é•·</option>
                                <option value="vice_director">å‰¯é™¢é•·</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="application-input-footer">
                <div class="left-buttons">
                    <button class="modal-btn secondary" onclick="backToAssetSelection()">â† è³‡ç”£é¸æŠã«æˆ»ã‚‹</button>
                </div>
                <div class="right-buttons">
                    <button class="modal-btn secondary" onclick="saveDraft()">ä¸‹æ›¸ãä¿å­˜</button>
                    <button class="modal-btn primary" onclick="submitApplication()">ç”³è«‹ã‚’æå‡º</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å³ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼ˆè¡Œè¡¨ç¤ºé …ç›®é¸æŠï¼‰ -->
    <div class="side-panel" id="sidePanel">
        <div class="side-panel-header">
            Excelå‡ºåŠ›é …ç›®ï¼ˆè¡Œï¼‰ã®é¸æŠ
        </div>
        <div class="side-panel-content">
            <div class="panel-section">
                <div class="panel-section-title">åŸºæœ¬æƒ…å ±</div>
                <div class="panel-item">
                    <input type="checkbox" id="col_facility" checked>
                    <label for="col_facility">æ–½è¨­å</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_building" checked>
                    <label for="col_building">æ£Ÿ</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_floor" checked>
                    <label for="col_floor">éš</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_department" checked>
                    <label for="col_department">éƒ¨é–€</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_section" checked>
                    <label for="col_section">éƒ¨ç½²</label>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="panel-section-title">åˆ†é¡æƒ…å ±</div>
                <div class="panel-item">
                    <input type="checkbox" id="col_category" checked>
                    <label for="col_category">Category</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_large" checked>
                    <label for="col_large">å¤§åˆ†é¡</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_medium" checked>
                    <label for="col_medium">ä¸­åˆ†é¡</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_item" checked>
                    <label for="col_item">å“ç›®</label>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="panel-section-title">è£½å“æƒ…å ±</div>
                <div class="panel-item">
                    <input type="checkbox" id="col_name" checked>
                    <label for="col_name">å“å</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_maker" checked>
                    <label for="col_maker">ãƒ¡ãƒ¼ã‚«ãƒ¼</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_model" checked>
                    <label for="col_model">å‹å¼</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_quantity" checked>
                    <label for="col_quantity">æ•°é‡</label>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="panel-section-title">å¯¸æ³•æƒ…å ±</div>
                <div class="panel-item">
                    <input type="checkbox" id="col_width" checked>
                    <label for="col_width">å¹…(W)</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_depth" checked>
                    <label for="col_depth">å¥¥è¡Œ(D)</label>
                </div>
                <div class="panel-item">
                    <input type="checkbox" id="col_height" checked>
                    <label for="col_height">é«˜ã•(H)</label>
                </div>
            </div>
        </div>
        <div class="side-panel-footer">
            <button class="panel-close-btn" onclick="toggleSidePanel()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- Choices.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script>
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const sampleData = [
            {
                no: 1,
                facility: 'ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ç—…é™¢',
                building: 'æœ¬é¤¨',
                floor: '2F',
                department: 'æ‰‹è¡“éƒ¨é–€',
                section: 'æ‰‹è¡“',
                category: 'åŒ»ç™‚æ©Ÿå™¨',
                largeClass: 'æ‰‹è¡“é–¢é€£æ©Ÿå™¨',
                mediumClass: 'é›»æ°—ãƒ¡ã‚¹ åŒæ¥µ',
                item: 'æ‰‹è¡“å°',
                name: 'é›»æ°—æ‰‹è¡“ç”¨é›»æºè£…ç½®2ã‚·ã‚¹ãƒ†ãƒ ',
                maker: 'åŒ»ç™‚',
                model: 'EW11 è¶…éŸ³æ³¢å¸å¼•å™¨',
                quantity: 1,
                width: 520,
                depth: 480,
                height: 1400
            },
            {
                no: 2,
                facility: 'ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ç—…é™¢',
                building: 'æœ¬é¤¨',
                floor: '2F',
                department: 'æ‰‹è¡“éƒ¨é–€',
                section: 'æ‰‹è¡“',
                category: 'åŒ»ç™‚æ©Ÿå™¨',
                largeClass: 'æ‰‹è¡“é–¢é€£æ©Ÿå™¨',
                mediumClass: 'é›»æ°—ãƒ¡ã‚¹ åŒæ¥µ',
                item: 'X',
                name: 'åŒ»ç§‘æ­¯ç§‘ç”¨æ´—æµ„å™¨',
                maker: 'åŒ»ç™‚',
                model: '',
                quantity: 1,
                width: '',
                depth: '',
                height: ''
            },
            // ã•ã‚‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
            ...Array.from({length: 18}, (_, i) => ({
                no: i + 3,
                facility: 'ã€‡ã€‡ã€‡ã€‡ã€‡ã€‡ç—…é™¢',
                building: 'æœ¬é¤¨',
                floor: '2F',
                department: 'æ‰‹è¡“éƒ¨é–€',
                section: 'æ‰‹è¡“',
                category: 'åŒ»ç™‚æ©Ÿå™¨',
                largeClass: 'æ‰‹è¡“é–¢é€£æ©Ÿå™¨',
                mediumClass: 'CTé–¢é€£',
                item: `å“ç›®${i + 3}`,
                name: `ã‚µãƒ³ãƒ—ãƒ«è£½å“${i + 3}`,
                maker: 'åŒ»ç™‚æ©Ÿå™¨',
                model: `MODEL-${i + 3}`,
                quantity: 1,
                width: 500 + i * 10,
                depth: 600 + i * 10,
                height: 700 + i * 10
            }))
        ];

        // ã‚«ãƒ¼ãƒ‰ç”¨ã‚µãƒ³ãƒ—ãƒ«ç”»åƒãƒ‡ãƒ¼ã‚¿
        const cardImages = [
            'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200"%3E%3Crect fill="%23ddd" width="300" height="200"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999" font-size="20"%3Eç”»åƒ1%3C/text%3E%3C/svg%3E',
            'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200"%3E%3Crect fill="%23ddd" width="300" height="200"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999" font-size="20"%3Eç”»åƒ2%3C/text%3E%3C/svg%3E'
        ];

        let currentView = 'list'; // 'list' or 'card'
        let selectedItems = new Set();
        let selectedMasterItems = new Set();

        // è³‡ç”£ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå‹•çš„èª­ã¿è¾¼ã¿ï¼‰
        let assetMasterData = [];
        let filteredMasterData = [];

        // ========================================
        // æ³¨æ„: ä»¥ä¸‹ã®é–¢æ•°ã¯ search-result-simple.js ã«ç§»å‹•æ¸ˆã¿ã§ã™
        // JSãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢æ•°ãŒå®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™
        // HTMLå†…ã®ã“ã‚Œã‚‰ã®é–¢æ•°ã¯å¤ã„å®Ÿè£…ã§ã€ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“
        // å‰Šé™¤äºˆå®šã§ã™ãŒã€å¿µã®ãŸã‚æ®‹ã—ã¦ã„ã¾ã™
        // ========================================

        // è³‡ç”£ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        async function loadAssetMasterData() {
            try {
                const cacheBuster = new Date().getTime();
                const response = await fetch(`src/data/asset-master.json?v=${cacheBuster}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                assetMasterData = data.assets.map(asset => ({
                    id: asset.id,
                    category: asset.category,
                    largeClass: asset.largeClass,
                    mediumClass: asset.mediumClass,
                    individualItem: asset.item,
                    maker: asset.manufacturer,
                    model: asset.model
                }));
                filteredMasterData = [...assetMasterData];
                console.log(`è³‡ç”£ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${assetMasterData.length}ä»¶`);
                return true;
            } catch (error) {
                console.error('è³‡ç”£ãƒã‚¹ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                alert('è³‡ç”£ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                return false;
            }
        }

        // åˆæœŸåŒ–ã¯search-result-simple.jsã®initSearchResultPage()ã«å§”ä»»

        // è³‡ç”£ãƒã‚¹ã‚¿æ¤œç´¢ç”¨ã®Choices.jsåˆæœŸåŒ–
        function initMasterChoices() {
            const masterSelectIds = ['masterCategory', 'masterLargeClass', 'masterMediumClass', 'masterIndividualItem', 'masterMaker', 'masterModel'];
            const instances = {};
            
            // å„ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®z-indexï¼ˆä¸Šã®è¡Œã»ã©é«˜ãï¼‰
            const zIndexMap = {
                'masterCategory': 100006,
                'masterLargeClass': 100006,
                'masterMediumClass': 100004,
                'masterIndividualItem': 100004,
                'masterMaker': 100002,
                'masterModel': 100002
            };
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶è¨­å®šã™ã‚‹é–¢æ•°
            function forceDropdownStyle(element, zIndex) {
                const choicesContainer = element.parentElement.querySelector('.choices');
                if (choicesContainer) {
                    const dropdown = choicesContainer.querySelector('.choices__list--dropdown');
                    if (dropdown) {
                        dropdown.style.position = 'absolute';
                        dropdown.style.zIndex = zIndex;
                        dropdown.style.backgroundColor = 'white';
                        dropdown.style.border = '1px solid #ccc';
                        dropdown.style.borderRadius = '4px';
                    }
                }
            }
            
            masterSelectIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    instances[id] = new Choices(element, {
                        searchEnabled: true,
                        shouldSort: false,
                        itemSelectText: '',
                        noResultsText: 'è©²å½“ãªã—',
                        placeholder: true,
                        placeholderValue: 'å…¨ã¦',
                        searchPlaceholderValue: 'æ¤œç´¢...',
                        removeItemButton: false
                    });
                    
                    // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒé–‹ã„ãŸã¨ãã«å¼·åˆ¶è¨­å®š
                    element.addEventListener('showDropdown', () => {
                        setTimeout(() => {
                            forceDropdownStyle(element, zIndexMap[id]);
                        }, 10);
                    });
                    
                    // MutationObserverã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¦ç´ ã®ç”Ÿæˆã‚’ç›£è¦–
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            mutation.addedNodes.forEach((node) => {
                                if (node.classList && node.classList.contains('choices__list--dropdown')) {
                                    node.style.position = 'absolute';
                                    node.style.zIndex = zIndexMap[id];
                                    node.style.backgroundColor = 'white';
                                    node.style.border = '1px solid #ccc';
                                    node.style.borderRadius = '4px';
                                }
                            });
                        });
                    });
                    
                    const choicesContainer = element.parentElement.querySelector('.choices');
                    if (choicesContainer) {
                        observer.observe(choicesContainer, {
                            childList: true,
                            subtree: true
                        });
                    }
                    
                    // åˆæœŸè¨­å®š
                    setTimeout(() => {
                        forceDropdownStyle(element, zIndexMap[id]);
                    }, 200);
                }
            });
            
            return instances;
        }

        let masterChoicesInstances = null;

        // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderListView() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            sampleData.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="checkbox" class="row-checkbox" data-no="${item.no}" onchange="handleRowSelect()"></td>
                    <td>${item.no}</td>
                    <td>${item.facility}</td>
                    <td>${item.building}</td>
                    <td>${item.floor}</td>
                    <td>${item.department}</td>
                    <td>${item.section}</td>
                    <td>${item.category}</td>
                    <td>${item.largeClass}</td>
                    <td>${item.mediumClass}</td>
                    <td>${item.item}</td>
                    <td>${item.name}</td>
                    <td>${item.maker}</td>
                    <td>${item.model}</td>
                    <td>${item.quantity}</td>
                    <td>${item.width || ''}</td>
                    <td>${item.depth || ''}</td>
                    <td>${item.height || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderCardView() {
            const cardView = document.getElementById('cardView');
            cardView.innerHTML = '';
            
            sampleData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.setAttribute('data-no', item.no);
                card.onclick = (e) => {
                    if (e.target.type !== 'checkbox') {
                        toggleCardSelection(item.no);
                    }
                };
                
                const imageUrl = cardImages[index % cardImages.length];
                
                card.innerHTML = `
                    <input type="checkbox" class="card-checkbox" data-no="${item.no}" onclick="event.stopPropagation(); toggleCardSelection(${item.no})">
                    <img src="${imageUrl}" class="card-image" alt="è³‡ç”£ç”»åƒ">
                    <div class="card-number">ã‚·ãƒ¼ãƒ«No: 0${150 + index}</div>
                    <div class="card-info">
                        <span class="card-label">å“ç›®:</span>
                        <span class="card-value">${item.item}</span>
                    </div>
                    <div class="card-info">
                        <span class="card-label">å“å:</span>
                        <span class="card-value">${item.name}</span>
                    </div>
                    <div class="card-info">
                        <span class="card-label">ãƒ¡ãƒ¼ã‚«ãƒ¼:</span>
                        <span class="card-value">${item.maker}</span>
                    </div>
                    <div class="card-info">
                        <span class="card-label">å‹å¼:</span>
                        <span class="card-value">${item.model}</span>
                    </div>
                    ${item.width && item.depth && item.height ? `
                    <div class="card-dimensions">
                        <div class="card-dim">
                            <div class="card-dim-label">W</div>
                            <div class="card-dim-value">${item.width}</div>
                        </div>
                        <div class="card-dim">
                            <div class="card-dim-label">D</div>
                            <div class="card-dim-value">${item.depth}</div>
                        </div>
                        <div class="card-dim">
                            <div class="card-dim-label">H</div>
                            <div class="card-dim-value">${item.height}</div>
                        </div>
                    </div>
                    ` : ''}
                `;
                
                cardView.appendChild(card);
            });
        }

        // è¡¨ç¤ºåˆ‡æ›¿
        function toggleView() {
            const listView = document.getElementById('listView');
            const cardView = document.getElementById('cardView');
            const viewBtn = document.getElementById('viewToggleBtn');
            const exportBtn = document.getElementById('exportBtn');
            
            if (currentView === 'list') {
                currentView = 'card';
                listView.classList.add('hidden');
                cardView.classList.add('active');
                viewBtn.textContent = 'ğŸ—‚ï¸';
                exportBtn.textContent = 'ğŸ“„';
            } else {
                currentView = 'list';
                listView.classList.remove('hidden');
                cardView.classList.remove('active');
                viewBtn.textContent = 'ğŸ“‹';
                exportBtn.textContent = 'ğŸ“Š';
            }
            
            // é¸æŠçŠ¶æ…‹ã‚’åŒæœŸ
            syncSelections();
        }

        // å…¨é¸æŠ
        function handleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.row-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
                const no = parseInt(cb.getAttribute('data-no'));
                if (selectAll.checked) {
                    selectedItems.add(no);
                } else {
                    selectedItems.delete(no);
                }
            });
            
            updateSelectionInfo();
            syncSelections();
        }

        // è¡Œé¸æŠ
        function handleRowSelect() {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            const selectAll = document.getElementById('selectAll');
            
            selectedItems.clear();
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selectedItems.add(parseInt(cb.getAttribute('data-no')));
                }
            });
            
            selectAll.checked = checkboxes.length === selectedItems.size;
            updateSelectionInfo();
            syncSelections();
        }

        // ã‚«ãƒ¼ãƒ‰é¸æŠ
        function toggleCardSelection(no) {
            if (selectedItems.has(no)) {
                selectedItems.delete(no);
            } else {
                selectedItems.add(no);
            }
            
            updateSelectionInfo();
            syncSelections();
        }

        // é¸æŠçŠ¶æ…‹ã®åŒæœŸ
        function syncSelections() {
            // ãƒ†ãƒ¼ãƒ–ãƒ«ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.row-checkbox').forEach(cb => {
                const no = parseInt(cb.getAttribute('data-no'));
                cb.checked = selectedItems.has(no);
                const row = cb.closest('tr');
                if (selectedItems.has(no)) {
                    row.classList.add('selected');
                } else {
                    row.classList.remove('selected');
                }
            });
            
            // ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.asset-card').forEach(card => {
                const no = parseInt(card.getAttribute('data-no'));
                const checkbox = card.querySelector('.card-checkbox');
                checkbox.checked = selectedItems.has(no);
                if (selectedItems.has(no)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // é¸æŠæƒ…å ±ã®æ›´æ–°
        function updateSelectionInfo() {
            const info = document.getElementById('selectionInfo');
            info.textContent = `${selectedItems.size}ä»¶é¸æŠä¸­`;

            // è³‡ç”£é¸æŠãŒå¿…è¦ãªãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
            const hasSelection = selectedItems.size > 0;

            // æ—¢å­˜è³‡ç”£ãƒ™ãƒ¼ã‚¹ã®ç”³è«‹ãƒœã‚¿ãƒ³
            const expansionBtn = document.getElementById('expansionBtn');
            const renewalBtn = document.getElementById('renewalBtn');
            const moveBtn = document.getElementById('moveBtn');
            const disposalBtn = document.getElementById('disposalBtn');
            const holdBtn = document.getElementById('holdBtn');
            const inventoryBtn = document.getElementById('inventoryBtn');

            if (expansionBtn) expansionBtn.disabled = !hasSelection;
            if (renewalBtn) renewalBtn.disabled = !hasSelection;
            if (moveBtn) moveBtn.disabled = !hasSelection;
            if (disposalBtn) disposalBtn.disabled = !hasSelection;
            if (holdBtn) holdBtn.disabled = !hasSelection;
            if (inventoryBtn) inventoryBtn.disabled = !hasSelection;
        }
        
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¶å¾¡
        function toggleNavMenu() {
            const btn = document.querySelector('.nav-menu-btn');
            const menu = document.getElementById('navMenuDropdown');

            const isActive = menu.classList.contains('active');

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹é–‰
            if (isActive) {
                btn.classList.remove('active');
                menu.classList.remove('active');
            } else {
                btn.classList.add('active');
                menu.classList.add('active');
            }
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenuDropdown');
            const navMenuBtn = document.querySelector('.nav-menu-btn');

            if (navMenu && !event.target.closest('.nav-menu')) {
                navMenu.classList.remove('active');
                if (navMenuBtn) navMenuBtn.classList.remove('active');
            }
        });

        // ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«åˆ‡æ›¿
        function toggleSidePanel() {
            const panel = document.getElementById('sidePanel');
            panel.classList.toggle('active');
        }

        // Excel/PDFå‡ºåŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«
        function handleExport() {
            const modal = document.getElementById('exportModal');
            const title = document.getElementById('exportModalTitle');
            
            if (currentView === 'list') {
                title.textContent = 'Excelå‡ºåŠ›é …ç›®ï¼ˆè¡Œï¼‰ã®é¸æŠ';
                document.querySelector('.modal-button').textContent = 'ã“ã®æ¡ä»¶ã§Excelå‡ºåŠ›';
            } else {
                title.textContent = 'PDFå‡ºåŠ›é …ç›®ã®é¸æŠ';
                document.querySelector('.modal-button').textContent = 'ã“ã®æ¡ä»¶ã§PDFå‡ºåŠ›';
            }
            
            modal.classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        // Excel/PDFå‡ºåŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        function handleExportModalOutsideClick(event) {
            if (event.target.id === 'exportModal') {
                closeExportModal();
            }
        }

        function selectExportTemplate(type) {
            console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ:', type);
            // å®Ÿè£…: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠå‡¦ç†
        }

        function executeExport() {
            console.log('å‡ºåŠ›å®Ÿè¡Œ');
            alert(currentView === 'list' ? 'Excelå‡ºåŠ›ã‚’å®Ÿè¡Œã—ã¾ã™' : 'PDFå‡ºåŠ›ã‚’å®Ÿè¡Œã—ã¾ã™');
            closeExportModal();
        }

        function selectCustomColumns() {
            console.log('ä»»æ„é …ç›®é¸æŠ');
            closeExportModal();
            toggleSidePanel();
        }

        // ç”³è«‹å‡¦ç†
        function handleNewPurchaseRequest() {
            // æ–°è¦è³¼å…¥ï¼šè³‡ç”£ãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠ
            openAssetMasterModal();
        }

        function handleExpansionRequest() {
            // å¢—è¨­ï¼šé¸æŠã—ãŸè³‡ç”£ã¨åŒã˜ã‚‚ã®ã‚’è¿½åŠ è³¼å…¥
            if (selectedItems.size === 0) {
                alert('å¢—è¨­è³¼å…¥ç”³è«‹ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            openApplicationInputModalWithType('å¢—è¨­è³¼å…¥ç”³è«‹');
        }

        function handleRenewalRequest() {
            // æ›´æ–°ï¼šé¸æŠã—ãŸè³‡ç”£ã‚’æ–°ã—ã„ã‚‚ã®ã«æ›´æ–°ï¼ˆæ—§è³‡ç”£ã¯æ‰¿èªå¾Œã«å»ƒæ£„äºˆå®šã¸ï¼‰
            if (selectedItems.size === 0) {
                alert('æ›´æ–°è³¼å…¥ç”³è«‹ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            openApplicationInputModalWithType('æ›´æ–°è³¼å…¥ç”³è«‹');
        }

        function handleMoveRequest() {
            // ç§»å‹•ï¼šé¸æŠã—ãŸè³‡ç”£ã®è¨­ç½®å ´æ‰€ã‚’å¤‰æ›´
            if (selectedItems.size === 0) {
                alert('ç§»å‹•ç”³è«‹ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            openApplicationInputModalWithType('ç§»å‹•ç”³è«‹');
        }

        function handleDisposalRequest() {
            // å»ƒæ£„ï¼šé¸æŠã—ãŸè³‡ç”£ã‚’å»ƒæ£„äºˆå®šã«
            if (selectedItems.size === 0) {
                alert('å»ƒæ£„ç”³è«‹ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            openApplicationInputModalWithType('å»ƒæ£„ç”³è«‹');
        }

        function handleHoldRequest() {
            // ä¿ç•™ï¼šé¸æŠã—ãŸè³‡ç”£ã‚’ä¿ç•™çŠ¶æ…‹ã«
            if (selectedItems.size === 0) {
                alert('ä¿ç•™ç”³è«‹ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            openApplicationInputModalWithType('ä¿ç•™ç”³è«‹');
        }
        
        // è³‡ç”£æ£šå¸ã—å‡¦ç†
        function handleInventory() {
            if (selectedItems.size === 0) {
                alert('æ£šå¸ã—ã‚’è¡Œã†è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            // æ£šå¸ã—ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºï¼ˆã¾ãŸã¯åˆ¥ç”»é¢ã¸é·ç§»ï¼‰
            const confirmMsg = `é¸æŠã—ãŸ${selectedItems.size}ä»¶ã®è³‡ç”£ã®æ£šå¸ã—ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ\n\næ£šå¸ã—å†…å®¹ï¼š\nãƒ»è³‡ç”£ã®ç¾ç‰©ç¢ºèª\nãƒ»è¨­ç½®å ´æ‰€ã®ç¢ºèª\nãƒ»çŠ¶æ…‹ã®ç¢ºèª\n\nâ€»å»ƒæ£„ãƒ»ç§»å‹•ãŒå¿…è¦ãªå ´åˆã¯ç”³è«‹ç”»é¢ã¸é·ç§»ã—ã¾ã™`;

            if (confirm(confirmMsg)) {
                alert('æ£šå¸ã—ç”»é¢ã«é·ç§»ã—ã¾ã™');
                // å®Ÿè£…: æ£šå¸ã—ç”»é¢ã¸ã®é·ç§»
                // window.location.href = '/inventory?assets=' + Array.from(selectedItems).join(',');
            }
        }

        // ç”»é¢é·ç§»é–¢æ•°
        function goToApplicationList() {
            alert('ç”³è«‹ä¸€è¦§ç”»é¢ã«é·ç§»ã—ã¾ã™');
            // å®Ÿè£…: ç”³è«‹ä¸€è¦§ç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            // window.location.href = '/application-list';
        }

        function goToExecutionPendingList() {
            alert('åŸ·è¡Œå¾…ã¡ä¸€è¦§ç”»é¢ã«é·ç§»ã—ã¾ã™');
            // å®Ÿè£…: åŸ·è¡Œå¾…ã¡ä¸€è¦§ç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            // window.location.href = '/execution-pending-list';
        }

        function goToQuoteOCR() {
            alert('è¦‹ç©æ›¸AI-OCRç”»é¢ã«é·ç§»ã—ã¾ã™');
            // å®Ÿè£…: è¦‹ç©æ›¸AI-OCRç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            // window.location.href = '/quote-ocr';
        }

        // è³‡ç”£ãƒã‚¹ã‚¿ãƒ¢ãƒ¼ãƒ€ãƒ«
        async function openAssetMasterModal() {
            selectedMasterItems.clear();

            // ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿ã®å ´åˆã¯èª­ã¿è¾¼ã‚€
            if (assetMasterData.length === 0) {
                const loaded = await loadAssetMasterData();
                if (!loaded) return;
            }

            // æ—¢å­˜ã®Choices.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å…ˆã«ç ´æ£„
            if (masterChoicesInstances) {
                Object.values(masterChoicesInstances).forEach(instance => {
                    if (instance) {
                        try {
                            instance.destroy();
                        } catch (e) {
                            console.log('Destroy error:', e);
                        }
                    }
                });
                masterChoicesInstances = null;
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('assetMasterModal').classList.add('active');

            // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®é¸æŠè‚¢ã‚’ç”Ÿæˆã¨Choices.jsåˆæœŸåŒ–
            setTimeout(() => {
                // å…ˆã«Choices.jsã‚’åˆæœŸåŒ–ï¼ˆç©ºã®çŠ¶æ…‹ã§ï¼‰
                masterChoicesInstances = initMasterChoices();

                // æ¬¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦é¸æŠè‚¢ã‚’è¨­å®š
                populateMasterDropdowns();

                updateMasterSelectionInfo();
                // åˆæœŸè¡¨ç¤º
                renderAssetMasterTable();
            }, 150);
        }

        function closeAssetMasterModal() {
            document.getElementById('assetMasterModal').classList.remove('active');
            
            // Choices.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç ´æ£„
            if (masterChoicesInstances) {
                Object.values(masterChoicesInstances).forEach(instance => {
                    if (instance) {
                        try {
                            instance.destroy();
                        } catch (e) {
                            console.log('Destroy error:', e);
                        }
                    }
                });
                masterChoicesInstances = null;
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        function handleModalOutsideClick(event) {
            if (event.target.id === 'assetMasterModal') {
                closeAssetMasterModal();
            }
        }

        // è³‡ç”£ãƒã‚¹ã‚¿ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠè‚¢ã‚’ç”Ÿæˆ
        function populateMasterDropdowns() {
            console.log('=== populateMasterDropdowns called ===');
            console.log('assetMasterData.length:', assetMasterData.length);
            console.log('assetMasterData sample:', assetMasterData.slice(0, 2));

            // å„é …ç›®ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå€¤ã‚’å–å¾—ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼‰
            const categories = [...new Set(assetMasterData.map(item => item.category))].sort();
            const largeClasses = [...new Set(assetMasterData.map(item => item.largeClass))].sort();
            const mediumClasses = [...new Set(assetMasterData.map(item => item.mediumClass))].sort();
            const individualItems = [...new Set(assetMasterData.map(item => item.individualItem))].sort();
            const makers = [...new Set(assetMasterData.map(item => item.maker))].sort();
            const models = [...new Set(assetMasterData.map(item => item.model))].sort();

            console.log('categories:', categories);
            console.log('largeClasses:', largeClasses);
            console.log('individualItems:', individualItems);

            // å…¨é …ç›®ã‚’åˆæœŸè¨­å®šï¼ˆã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ãªã—ã§å…¨é¸æŠè‚¢ã‚’è¡¨ç¤ºï¼‰
            populateSelect('masterCategory', categories);
            populateSelect('masterLargeClass', largeClasses);
            populateSelect('masterMediumClass', mediumClasses);
            populateSelect('masterIndividualItem', individualItems);
            populateSelect('masterMaker', makers);
            populateSelect('masterModel', models);

            // Choices.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯é¸æŠè‚¢ã‚’æ›´æ–°
            if (masterChoicesInstances) {
                updateChoicesOptions('masterCategory', categories);
                updateChoicesOptions('masterLargeClass', largeClasses);
                updateChoicesOptions('masterMediumClass', mediumClasses);
                updateChoicesOptions('masterIndividualItem', individualItems);
                updateChoicesOptions('masterMaker', makers);
                updateChoicesOptions('masterModel', models);
            }

            // ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupMasterCascade();
        }

        // Choices.jsã®é¸æŠè‚¢ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateChoicesOptions(selectId, options) {
            console.log(`updateChoicesOptions called for ${selectId}`);
            console.log('masterChoicesInstances:', masterChoicesInstances);
            console.log('options:', options);

            if (!masterChoicesInstances) {
                alert(`ERROR: masterChoicesInstances is null for ${selectId}`);
                return;
            }

            if (!masterChoicesInstances[selectId]) {
                alert(`ERROR: masterChoicesInstances[${selectId}] is null`);
                return;
            }

            const instance = masterChoicesInstances[selectId];
            instance.clearStore();
            const choices = [{ value: '', label: 'å…¨ã¦', selected: true }].concat(
                options.map(v => ({ value: v, label: v }))
            );
            instance.setChoices(choices, 'value', 'label', true);
            console.log(`Updated Choices.js for ${selectId}: ${options.length} options`);
            alert(`Successfully updated ${selectId} with ${options.length} options`);
        }

        // ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰æ¤œç´¢ã®è¨­å®šï¼ˆå“ç›®é¸æŠæ™‚ã«ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»å‹å¼ã‚’æ›´æ–°ï¼‰
        function setupMasterCascade() {
            const categorySelect = document.getElementById('masterCategory');
            const largeClassSelect = document.getElementById('masterLargeClass');
            const mediumClassSelect = document.getElementById('masterMediumClass');
            const individualItemSelect = document.getElementById('masterIndividualItem');
            const makerSelect = document.getElementById('masterMaker');

            // å“ç›®å¤‰æ›´æ™‚ â†’ ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»å‹å¼ã‚’æ›´æ–°
            if (individualItemSelect) {
                individualItemSelect.addEventListener('change', function() {
                    const category = categorySelect.value;
                    const largeClass = largeClassSelect.value;
                    const mediumClass = mediumClassSelect.value;
                    const individualItem = this.value;

                    let filteredData = assetMasterData;
                    if (category) filteredData = filteredData.filter(item => item.category === category);
                    if (largeClass) filteredData = filteredData.filter(item => item.largeClass === largeClass);
                    if (mediumClass) filteredData = filteredData.filter(item => item.mediumClass === mediumClass);
                    if (individualItem) filteredData = filteredData.filter(item => item.individualItem === individualItem);

                    const makers = [...new Set(filteredData.map(item => item.maker))].sort();
                    populateSelect('masterMaker', makers);

                    // å‹å¼ã‚’ã‚¯ãƒªã‚¢
                    const allModels = [...new Set(assetMasterData.map(item => item.model))].sort();
                    populateSelect('masterModel', allModels);

                    // Choices.jsã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ›´æ–°
                    if (masterChoicesInstances?.masterMaker) {
                        masterChoicesInstances.masterMaker.clearStore();
                        masterChoicesInstances.masterMaker.setChoices(
                            [{ value: '', label: 'å…¨ã¦', selected: true }].concat(
                                makers.map(v => ({ value: v, label: v }))
                            ),
                            'value', 'label', true
                        );
                    }
                });
            }

            // ãƒ¡ãƒ¼ã‚«ãƒ¼å¤‰æ›´æ™‚ â†’ å‹å¼ã‚’æ›´æ–°
            if (makerSelect) {
                makerSelect.addEventListener('change', function() {
                    const category = categorySelect.value;
                    const largeClass = largeClassSelect.value;
                    const mediumClass = mediumClassSelect.value;
                    const individualItem = individualItemSelect.value;
                    const maker = this.value;

                    let filteredData = assetMasterData;
                    if (category) filteredData = filteredData.filter(item => item.category === category);
                    if (largeClass) filteredData = filteredData.filter(item => item.largeClass === largeClass);
                    if (mediumClass) filteredData = filteredData.filter(item => item.mediumClass === mediumClass);
                    if (individualItem) filteredData = filteredData.filter(item => item.individualItem === individualItem);
                    if (maker) filteredData = filteredData.filter(item => item.maker === maker);

                    const models = [...new Set(filteredData.map(item => item.model))].sort();
                    populateSelect('masterModel', models);

                    // Choices.jsã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ›´æ–°
                    if (masterChoicesInstances?.masterModel) {
                        masterChoicesInstances.masterModel.clearStore();
                        masterChoicesInstances.masterModel.setChoices(
                            [{ value: '', label: 'å…¨ã¦', selected: true }].concat(
                                models.map(v => ({ value: v, label: v }))
                            ),
                            'value', 'label', true
                        );
                    }
                });
            }
        }

        // selectã‚¿ã‚°ã«é¸æŠè‚¢ã‚’è¿½åŠ 
        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã€Œå…¨ã¦ã€ä»¥å¤–ï¼‰ã‚’ã‚¯ãƒªã‚¢
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        // è³‡ç”£ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æç”»
        function renderAssetMasterTable() {
            const tbody = document.getElementById('assetMasterTableBody');
            const resultCount = document.getElementById('assetMasterResultCount');

            if (filteredMasterData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; color: #999;">æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                resultCount.textContent = '0ä»¶';
                return;
            }

            resultCount.textContent = `${filteredMasterData.length}ä»¶`;

            tbody.innerHTML = filteredMasterData.map(asset => `
                <tr style="border-bottom: 1px solid #eee; cursor: pointer;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
                    <td style="padding: 10px;">
                        <input type="checkbox" class="master-row-checkbox" data-id="${asset.id}"
                               ${selectedMasterItems.has(asset.id) ? 'checked' : ''}
                               onchange="handleMasterRowSelect(${asset.id})">
                    </td>
                    <td style="padding: 10px;">${asset.category}</td>
                    <td style="padding: 10px;">${asset.largeClass}</td>
                    <td style="padding: 10px;">${asset.mediumClass}</td>
                    <td style="padding: 10px;">${asset.individualItem}</td>
                    <td style="padding: 10px;">${asset.maker}</td>
                    <td style="padding: 10px;">${asset.model}</td>
                </tr>
            `).join('');
        }

        // è³‡ç”£ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterAssetMasterTable() {
            const category = document.getElementById('masterCategory').value;
            const largeClass = document.getElementById('masterLargeClass').value;
            const mediumClass = document.getElementById('masterMediumClass').value;
            const individualItem = document.getElementById('masterIndividualItem').value;
            const maker = document.getElementById('masterMaker').value;
            const model = document.getElementById('masterModel').value;
            const keyword = document.getElementById('masterKeywordSearch').value.trim();

            // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ6é …ç›®ã™ã¹ã¦å¯¾å¿œï¼‰
            filteredMasterData = assetMasterData.filter(item => {
                return (!category || item.category === category) &&
                       (!largeClass || item.largeClass === largeClass) &&
                       (!mediumClass || item.mediumClass === mediumClass) &&
                       (!individualItem || item.individualItem === individualItem) &&
                       (!maker || item.maker === maker) &&
                       (!model || item.model === model);
            });

            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆæ›–æ˜§æ¤œç´¢ï¼‰
            if (keyword) {
                const keywords = keyword.toLowerCase().split(/\s+/);
                filteredMasterData = filteredMasterData.filter(item => {
                    const searchText = [
                        item.category,
                        item.largeClass,
                        item.mediumClass,
                        item.individualItem,
                        item.maker,
                        item.model
                    ].join(' ').toLowerCase();

                    return keywords.every(kw => searchText.includes(kw));
                });
            }

            renderAssetMasterTable();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢æ©Ÿèƒ½
        function resetMasterFilter() {
            // å…¨ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('masterCategory').value = '';
            document.getElementById('masterLargeClass').value = '';
            document.getElementById('masterMediumClass').value = '';
            document.getElementById('masterIndividualItem').value = '';
            document.getElementById('masterMaker').value = '';
            document.getElementById('masterModel').value = '';
            document.getElementById('masterKeywordSearch').value = '';

            // Choices.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (masterChoicesInstances) {
                Object.values(masterChoicesInstances).forEach(instance => {
                    if (instance && instance.removeActiveItemsByValue) {
                        instance.removeActiveItemsByValue('');
                    }
                });
            }

            // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å†è¡¨ç¤º
            filteredMasterData = [...assetMasterData];
            renderAssetMasterTable();
        }

        // ãƒã‚¹ã‚¿è¡Œé¸æŠ
        function handleMasterRowSelect(id) {
            if (selectedMasterItems.has(id)) {
                selectedMasterItems.delete(id);
            } else {
                selectedMasterItems.add(id);
            }
            renderSelectedAssets();
            updateMasterSelectionInfo();
        }

        // ãƒã‚¹ã‚¿å…¨é¸æŠ
        function handleSelectAllMaster() {
            const selectAll = document.getElementById('selectAllMaster');
            const checkboxes = document.querySelectorAll('.master-row-checkbox');

            checkboxes.forEach(cb => {
                const id = parseInt(cb.getAttribute('data-id'));
                if (selectAll.checked) {
                    selectedMasterItems.add(id);
                    cb.checked = true;
                } else {
                    selectedMasterItems.delete(id);
                    cb.checked = false;
                }
            });

            renderSelectedAssets();
            updateMasterSelectionInfo();
        }

        // é¸æŠæ¸ˆã¿è³‡ç”£ã‚’è¡¨ç¤º
        function renderSelectedAssets() {
            const container = document.getElementById('selectedAssetsList');
            
            if (selectedMasterItems.size === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">è³‡ç”£ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            const selectedAssets = assetMasterData.filter(item => selectedMasterItems.has(item.id));
            
            container.innerHTML = selectedAssets.map(asset => `
                <div class="selected-asset-card">
                    <div class="selected-asset-info">
                        <strong>${asset.individualItem}</strong> - ${asset.maker} ${asset.model}<br>
                        <small>${asset.category} > ${asset.largeClass} > ${asset.mediumClass}</small>
                    </div>
                    <button class="selected-asset-remove" onclick="removeSelectedAsset(${asset.id})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        // é¸æŠæ¸ˆã¿è³‡ç”£ã‚’å‰Šé™¤
        function removeSelectedAsset(id) {
            selectedMasterItems.delete(id);
            renderSelectedAssets();
            updateMasterSelectionInfo();
        }

        // è³‡ç”£ãƒã‚¹ã‚¿ã®å…¨é¸æŠ
        // è³‡ç”£ãƒã‚¹ã‚¿ã®é¸æŠæƒ…å ±æ›´æ–°
        function updateMasterSelectionInfo() {
            const info = document.getElementById('masterSelectionInfo');
            info.textContent = `${selectedMasterItems.size}ä»¶é¸æŠä¸­`;
        }

        // æ–°è¦è³¼å…¥ç”³è«‹ã®å®Ÿè¡Œ
        function submitNewPurchase() {
            if (selectedMasterItems.size === 0) {
                alert('è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            alert(`${selectedMasterItems.size}ä»¶ã®è³‡ç”£ãƒã‚¹ã‚¿ã‹ã‚‰æ–°è¦è³¼å…¥ç”³è«‹ã‚’è¡Œã„ã¾ã™`);
            closeAssetMasterModal();
        }
        
        // ç”³è«‹å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã¸é€²ã‚€
        let quotationCount = 0;
        
        function proceedToApplicationInput() {
            if (selectedMasterItems.size === 0) {
                alert('è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // è³‡ç”£ãƒã‚¹ã‚¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeAssetMasterModal();
            
            // ç”³è«‹å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            openApplicationInputModal();
        }
        
        function openApplicationInputModal() {
            const modal = document.getElementById('applicationInputModal');
            
            // ç¾åœ¨ã®æ—¥ä»˜ã‚’è¨­å®š
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('appDate').value = dateStr;
            
            // é¸æŠã•ã‚ŒãŸè³‡ç”£ã‚’è¡¨ç¤º
            displaySelectedAssets();
            
            // è¦‹ç©æ›¸ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ï¼ˆ1ã¤è¿½åŠ ï¼‰
            quotationCount = 0;
            document.getElementById('quotationList').innerHTML = '';
            addQuotationForm();
            
            modal.classList.add('active');
        }
        
        // ç”³è«‹ç¨®åˆ¥ã‚’æŒ‡å®šã—ã¦ç”³è«‹å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openApplicationInputModalWithType(applicationType) {
            if (selectedItems.size === 0) {
                alert('è³‡ç”£ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const modal = document.getElementById('applicationInputModal');

            // ç”³è«‹ç¨®åˆ¥ã‚’è¨­å®š
            document.getElementById('applicationTypeTitle').textContent = applicationType;
            document.getElementById('appType').value = applicationType;

            // ç¾åœ¨ã®æ—¥ä»˜ã‚’è¨­å®š
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('appDate').value = dateStr;

            // é¸æŠã•ã‚ŒãŸè³‡ç”£ã‚’è¡¨ç¤ºï¼ˆè³‡ç”£ãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚‚ã®ï¼‰
            displaySelectedAssetsFromList();

            // è¦‹ç©æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
            const quotationSection = document.querySelector('.application-section:has(#quotationList)');
            const needsQuotation = ['æ–°è¦è³¼å…¥ç”³è«‹', 'å¢—è¨­è³¼å…¥ç”³è«‹', 'æ›´æ–°è³¼å…¥ç”³è«‹'].includes(applicationType);

            if (quotationSection) {
                if (needsQuotation) {
                    quotationSection.style.display = 'block';
                    // è¦‹ç©æ›¸ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ï¼ˆ1ã¤è¿½åŠ ï¼‰
                    quotationCount = 0;
                    document.getElementById('quotationList').innerHTML = '';
                    addQuotationForm();
                } else {
                    quotationSection.style.display = 'none';
                }
            }

            // ç§»å‹•ç”³è«‹ã®å ´åˆã¯ç§»å‹•å…ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            updateApplicationFormFields(applicationType);

            modal.classList.add('active');
        }

        // ç”³è«‹ç¨®åˆ¥ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°
        function updateApplicationFormFields(applicationType) {
            // å¯¾è±¡è³‡ç”£æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«è¿½åŠ æƒ…å ±ã‚’æŒ¿å…¥
            const targetAssetsSection = document.querySelector('.application-section:has(#selectedAssetsDisplay)');

            // æ—¢å­˜ã®è¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
            const existingExtraSection = document.getElementById('extraApplicationSection');
            if (existingExtraSection) {
                existingExtraSection.remove();
            }

            // ç”³è«‹ç¨®åˆ¥ã«å¿œã˜ãŸè¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            let extraHTML = '';

            if (applicationType === 'ç§»å‹•ç”³è«‹') {
                extraHTML = `
                    <div class="application-section" id="extraApplicationSection">
                        <div class="application-section-title">ğŸ“ ç§»å‹•å…ˆæƒ…å ±</div>
                        <div class="application-form-group">
                            <label>ç§»å‹•å…ˆ æ£Ÿ <span class="required">*</span></label>
                            <select id="moveToBuilding">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="æœ¬é¤¨">æœ¬é¤¨</option>
                                <option value="åˆ¥é¤¨">åˆ¥é¤¨</option>
                                <option value="æ–°é¤¨">æ–°é¤¨</option>
                                <option value="ç ”ç©¶æ£Ÿ">ç ”ç©¶æ£Ÿ</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>ç§»å‹•å…ˆ éš <span class="required">*</span></label>
                            <select id="moveToFloor">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="B1F">B1F</option>
                                <option value="1F">1F</option>
                                <option value="2F">2F</option>
                                <option value="3F">3F</option>
                                <option value="4F">4F</option>
                                <option value="5F">5F</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>ç§»å‹•å…ˆ éƒ¨é–€ <span class="required">*</span></label>
                            <input type="text" id="moveToDepartment" placeholder="ä¾‹: å†…ç§‘">
                        </div>
                        <div class="application-form-group">
                            <label>ç§»å‹•å…ˆ éƒ¨ç½² <span class="required">*</span></label>
                            <input type="text" id="moveToSection" placeholder="ä¾‹: å†…ç§‘å¤–æ¥">
                        </div>
                        <div class="application-form-group">
                            <label>ç§»å‹•äºˆå®šæ—¥ <span class="required">*</span></label>
                            <input type="date" id="moveDate">
                        </div>
                    </div>
                `;
            } else if (applicationType === 'å»ƒæ£„ç”³è«‹') {
                extraHTML = `
                    <div class="application-section" id="extraApplicationSection">
                        <div class="application-section-title">ğŸ—‘ï¸ å»ƒæ£„æƒ…å ±</div>
                        <div class="application-form-group">
                            <label>å»ƒæ£„ç†ç”± <span class="required">*</span></label>
                            <select id="disposalReason">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="è€ç”¨å¹´æ•°è¶…é">è€ç”¨å¹´æ•°è¶…é</option>
                                <option value="æ•…éšœ">æ•…éšœï¼ˆä¿®ç†ä¸å¯ï¼‰</option>
                                <option value="æ—§æ©Ÿç¨®">æ—§æ©Ÿç¨®ï¼ˆæ›´æ–°æ¸ˆã¿ï¼‰</option>
                                <option value="ä½¿ç”¨åœæ­¢">ä½¿ç”¨åœæ­¢</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>å»ƒæ£„äºˆå®šæ—¥ <span class="required">*</span></label>
                            <input type="date" id="disposalDate">
                        </div>
                        <div class="application-form-group">
                            <label>å»ƒæ£„æ–¹æ³•</label>
                            <select id="disposalMethod">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="ç”£æ¥­å»ƒæ£„ç‰©å‡¦ç†">ç”£æ¥­å»ƒæ£„ç‰©å‡¦ç†</option>
                                <option value="ãƒªã‚µã‚¤ã‚¯ãƒ«">ãƒªã‚µã‚¤ã‚¯ãƒ«</option>
                                <option value="ãƒ¡ãƒ¼ã‚«ãƒ¼å¼•å–">ãƒ¡ãƒ¼ã‚«ãƒ¼å¼•å–</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                    </div>
                `;
            } else if (applicationType === 'ä¿ç•™ç”³è«‹') {
                extraHTML = `
                    <div class="application-section" id="extraApplicationSection">
                        <div class="application-section-title">â¸ï¸ ä¿ç•™æƒ…å ±</div>
                        <div class="application-form-group">
                            <label>ä¿ç•™ç†ç”± <span class="required">*</span></label>
                            <select id="holdReason">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="æ•…éšœä¸­">æ•…éšœä¸­ï¼ˆä¿®ç†å¾…ã¡ï¼‰</option>
                                <option value="ç‚¹æ¤œä¸­">ç‚¹æ¤œä¸­</option>
                                <option value="ä½¿ç”¨ä¸€æ™‚åœæ­¢">ä½¿ç”¨ä¸€æ™‚åœæ­¢</option>
                                <option value="ç§»å‹•äºˆå®š">ç§»å‹•äºˆå®š</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>ä¿ç•™æœŸé–“ï¼ˆé–‹å§‹æ—¥ï¼‰ <span class="required">*</span></label>
                            <input type="date" id="holdStartDate">
                        </div>
                        <div class="application-form-group">
                            <label>ä¿ç•™æœŸé–“ï¼ˆçµ‚äº†äºˆå®šæ—¥ï¼‰</label>
                            <input type="date" id="holdEndDate">
                        </div>
                    </div>
                `;
            } else if (applicationType === 'æ›´æ–°è³¼å…¥ç”³è«‹') {
                extraHTML = `
                    <div class="application-section" id="extraApplicationSection">
                        <div class="application-section-title">ğŸ”„ æ›´æ–°æƒ…å ±</div>
                        <div class="application-form-group">
                            <label style="display: block; color: #e74c3c; font-weight: bold; margin-bottom: 10px;">
                                âš ï¸ æ³¨æ„: ã“ã®ç”³è«‹ãŒæœ€çµ‚æ‰¿èªã•ã‚Œã‚‹ã¨ã€é¸æŠã—ãŸè³‡ç”£ã¯è‡ªå‹•çš„ã«ã€Œå»ƒæ£„äºˆå®šã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¤‰æ›´ã•ã‚Œã¾ã™
                            </label>
                        </div>
                        <div class="application-form-group">
                            <label>æ›´æ–°ç†ç”± <span class="required">*</span></label>
                            <select id="renewalReason">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="è€ç”¨å¹´æ•°è¶…é">è€ç”¨å¹´æ•°è¶…é</option>
                                <option value="æ€§èƒ½ä¸è¶³">æ€§èƒ½ä¸è¶³</option>
                                <option value="æ•…éšœé »ç™º">æ•…éšœé »ç™º</option>
                                <option value="ä¿å®ˆçµ‚äº†">ä¿å®ˆçµ‚äº†</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>æ›´æ–°äºˆå®šæ—¥ <span class="required">*</span></label>
                            <input type="date" id="renewalDate">
                        </div>
                    </div>
                `;
            } else if (applicationType === 'å¢—è¨­è³¼å…¥ç”³è«‹') {
                extraHTML = `
                    <div class="application-section" id="extraApplicationSection">
                        <div class="application-section-title">â• å¢—è¨­æƒ…å ±</div>
                        <div class="application-form-group">
                            <label>å¢—è¨­å°æ•° <span class="required">*</span></label>
                            <input type="number" id="expansionQuantity" min="1" value="1" placeholder="ä¾‹: 2">
                        </div>
                        <div class="application-form-group">
                            <label>å¢—è¨­ç†ç”± <span class="required">*</span></label>
                            <select id="expansionReason">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="æ¥­å‹™æ‹¡å¤§">æ¥­å‹™æ‹¡å¤§</option>
                                <option value="åˆ©ç”¨é »åº¦å¢—åŠ ">åˆ©ç”¨é »åº¦å¢—åŠ </option>
                                <option value="ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                        <div class="application-form-group">
                            <label>ç´å…¥å¸Œæœ›æ—¥ <span class="required">*</span></label>
                            <input type="date" id="expansionDate">
                        </div>
                    </div>
                `;
            }

            if (extraHTML && targetAssetsSection) {
                targetAssetsSection.insertAdjacentHTML('afterend', extraHTML);
            }
        }
        
        function displaySelectedAssetsFromList() {
            const container = document.getElementById('selectedAssetsDisplay');
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é¸æŠã•ã‚ŒãŸè³‡ç”£ã‚’å–å¾—
            const selectedAssets = sampleData.filter(item => selectedItems.has(item.no));
            
            container.innerHTML = selectedAssets.map(asset => `
                <div class="selected-asset-display">
                    <div class="asset-name">${asset.name}</div>
                    <div class="asset-detail">
                        è³‡ç”£ç•ªå·: No.${asset.no} / ãƒ¡ãƒ¼ã‚«ãƒ¼: ${asset.maker} / å‹å¼: ${asset.model}<br>
                        è¨­ç½®å ´æ‰€: ${asset.building} ${asset.floor} ${asset.department} ${asset.section}
                    </div>
                </div>
            `).join('');
        }
        
        function closeApplicationInputModal() {
            const modal = document.getElementById('applicationInputModal');
            modal.classList.remove('active');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('appReason').value = '';
            document.getElementById('approver1').value = '';
            document.getElementById('approver2').value = '';
            document.getElementById('approver3').value = '';
            document.getElementById('quotationList').innerHTML = '';
        }
        
        function handleApplicationInputModalOutsideClick(event) {
            if (event.target.id === 'applicationInputModal') {
                if (confirm('å…¥åŠ›å†…å®¹ãŒå¤±ã‚ã‚Œã¾ã™ãŒã€é–‰ã˜ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    closeApplicationInputModal();
                }
            }
        }
        
        function displaySelectedAssets() {
            const container = document.getElementById('selectedAssetsDisplay');
            const selectedAssets = assetMasterData.filter(item => selectedMasterItems.has(item.id));
            
            container.innerHTML = selectedAssets.map(asset => `
                <div class="selected-asset-display">
                    <div class="asset-name">${asset.individualItem}</div>
                    <div class="asset-detail">
                        ãƒ¡ãƒ¼ã‚«ãƒ¼: ${asset.maker} / å‹å¼: ${asset.model}<br>
                        åˆ†é¡: ${asset.category} > ${asset.largeClass} > ${asset.mediumClass}
                    </div>
                </div>
            `).join('');
        }
        
        function addQuotationForm() {
            quotationCount++;
            const quotationList = document.getElementById('quotationList');
            
            const quotationHtml = `
                <div class="quotation-item" id="quotation${quotationCount}">
                    <div class="quotation-item-header">
                        <div class="quotation-item-title">è¦‹ç©æ›¸${quotationCount}</div>
                        <button class="quotation-remove-btn" onclick="removeQuotation(${quotationCount})">å‰Šé™¤</button>
                    </div>
                    <div class="quotation-fields">
                        <div>
                            <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">æ¥­è€…å <span style="color: #e74c3c;">*</span></label>
                            <input type="text" id="vendor${quotationCount}" placeholder="ä¾‹: â—¯â—¯ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">è¦‹ç©é‡‘é¡ï¼ˆå††ï¼‰ <span style="color: #e74c3c;">*</span></label>
                            <input type="number" id="amount${quotationCount}" placeholder="ä¾‹: 8500000">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">å‹å¼</label>
                            <input type="text" id="model${quotationCount}" placeholder="ä¾‹: US-3000X">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">ç´æœŸ</label>
                            <input type="date" id="delivery${quotationCount}">
                        </div>
                        <div class="full-width">
                            <label style="font-size: 12px; color: #555; margin-bottom: 5px; display: block;">è¦‹ç©æ›¸ãƒ•ã‚¡ã‚¤ãƒ« <span style="color: #e74c3c;">*</span></label>
                            <div class="quotation-file-input">
                                <input type="file" id="file${quotationCount}" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileSelect(${quotationCount})">
                                <span class="quotation-file-name" id="fileName${quotationCount}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            quotationList.insertAdjacentHTML('beforeend', quotationHtml);
        }
        
        function removeQuotation(id) {
            const quotationItem = document.getElementById(`quotation${id}`);
            if (quotationItem) {
                quotationItem.remove();
            }
        }
        
        function handleFileSelect(id) {
            const fileInput = document.getElementById(`file${id}`);
            const fileNameSpan = document.getElementById(`fileName${id}`);
            
            if (fileInput.files.length > 0) {
                fileNameSpan.textContent = fileInput.files[0].name;
            } else {
                fileNameSpan.textContent = '';
            }
        }
        
        function backToAssetSelection() {
            if (confirm('å…¥åŠ›å†…å®¹ãŒå¤±ã‚ã‚Œã¾ã™ãŒã€è³‡ç”£é¸æŠã«æˆ»ã£ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                closeApplicationInputModal();
                openAssetMasterModal();
            }
        }
        
        function saveDraft() {
            alert('ä¸‹æ›¸ãã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ');
            // å®Ÿè£…: ä¸‹æ›¸ãä¿å­˜å‡¦ç†
        }
        
        function submitApplication() {
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const applicationType = document.getElementById('appType').value;
            const reason = document.getElementById('appReason').value;
            const approver1 = document.getElementById('approver1').value;
            const approver2 = document.getElementById('approver2').value;
            const approver3 = document.getElementById('approver3').value;

            // åŸºæœ¬é …ç›®ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!reason) {
                alert('ç”³è«‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!approver1 || !approver2 || !approver3) {
                alert('ã™ã¹ã¦ã®æ‰¿èªè€…ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            // ç”³è«‹ç¨®åˆ¥ã”ã¨ã®å›ºæœ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (applicationType === 'ç§»å‹•ç”³è«‹') {
                const moveToBuilding = document.getElementById('moveToBuilding')?.value;
                const moveToFloor = document.getElementById('moveToFloor')?.value;
                const moveToDepartment = document.getElementById('moveToDepartment')?.value;
                const moveToSection = document.getElementById('moveToSection')?.value;
                const moveDate = document.getElementById('moveDate')?.value;

                if (!moveToBuilding || !moveToFloor || !moveToDepartment || !moveToSection || !moveDate) {
                    alert('ç§»å‹•å…ˆæƒ…å ±ã®ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            } else if (applicationType === 'å»ƒæ£„ç”³è«‹') {
                const disposalReason = document.getElementById('disposalReason')?.value;
                const disposalDate = document.getElementById('disposalDate')?.value;

                if (!disposalReason || !disposalDate) {
                    alert('å»ƒæ£„æƒ…å ±ã®ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            } else if (applicationType === 'ä¿ç•™ç”³è«‹') {
                const holdReason = document.getElementById('holdReason')?.value;
                const holdStartDate = document.getElementById('holdStartDate')?.value;

                if (!holdReason || !holdStartDate) {
                    alert('ä¿ç•™æƒ…å ±ã®ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            } else if (applicationType === 'æ›´æ–°è³¼å…¥ç”³è«‹') {
                const renewalReason = document.getElementById('renewalReason')?.value;
                const renewalDate = document.getElementById('renewalDate')?.value;

                if (!renewalReason || !renewalDate) {
                    alert('æ›´æ–°æƒ…å ±ã®ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            } else if (applicationType === 'å¢—è¨­è³¼å…¥ç”³è«‹') {
                const expansionQuantity = document.getElementById('expansionQuantity')?.value;
                const expansionReason = document.getElementById('expansionReason')?.value;
                const expansionDate = document.getElementById('expansionDate')?.value;

                if (!expansionQuantity || !expansionReason || !expansionDate) {
                    alert('å¢—è¨­æƒ…å ±ã®ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            }

            // è¦‹ç©æ›¸ãŒå¿…è¦ãªç”³è«‹ã®ãƒã‚§ãƒƒã‚¯
            const needsQuotation = ['æ–°è¦è³¼å…¥ç”³è«‹', 'å¢—è¨­è³¼å…¥ç”³è«‹', 'æ›´æ–°è³¼å…¥ç”³è«‹'].includes(applicationType);
            if (needsQuotation) {
                const quotationItems = document.querySelectorAll('.quotation-item');
                if (quotationItems.length === 0) {
                    alert('å°‘ãªãã¨ã‚‚1ã¤ã®è¦‹ç©æ›¸ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                    return;
                }

                let hasValidQuotation = false;
                quotationItems.forEach((item, index) => {
                    const id = item.id.replace('quotation', '');
                    const vendor = document.getElementById(`vendor${id}`)?.value;
                    const amount = document.getElementById(`amount${id}`)?.value;
                    const file = document.getElementById(`file${id}`)?.files[0];

                    if (vendor && amount && file) {
                        hasValidQuotation = true;
                    }
                });

                if (!hasValidQuotation) {
                    alert('è¦‹ç©æ›¸ã®å¿…é ˆé …ç›®ï¼ˆæ¥­è€…åã€é‡‘é¡ã€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            }

            // ç”³è«‹ã‚’æå‡º
            let confirmMessage = 'ç”³è«‹ã‚’æå‡ºã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ';
            if (applicationType === 'æ›´æ–°è³¼å…¥ç”³è«‹') {
                confirmMessage = 'ç”³è«‹ã‚’æå‡ºã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®ç”³è«‹ãŒæœ€çµ‚æ‰¿èªã•ã‚Œã‚‹ã¨ã€é¸æŠã—ãŸè³‡ç”£ã¯è‡ªå‹•çš„ã«ã€Œå»ƒæ£„äºˆå®šã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚';
            }

            if (confirm(confirmMessage)) {
                const appNumber = 'REQ-2025-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
                alert(`ç”³è«‹ãŒæå‡ºã•ã‚Œã¾ã—ãŸ\nç”³è«‹ç•ªå·: ${appNumber}\nç”³è«‹ç¨®åˆ¥: ${applicationType}`);
                closeApplicationInputModal();

                // é¸æŠã‚’ã‚¯ãƒªã‚¢
                selectedMasterItems.clear();
                selectedItems.clear();
                updateSelectionInfo();
                syncSelections();
            }
        }

        // å°åˆ·
        function handlePrint() {
            window.print();
        }

        // æˆ»ã‚‹
        function handleBack() {
            if (confirm('æ¤œç´¢ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹?')) {
                window.history.back();
            }
        }
    </script>

</div>
