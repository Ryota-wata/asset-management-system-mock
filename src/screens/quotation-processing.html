<!-- 見積処理画面 -->
<div id="quotationProcessingPage" class="quotation-processing-page">

    <div class="result-container">
        <!-- ヘッダー -->
        <header class="result-header">
            <div class="result-header-left">
                <div class="logo">
                    <div class="logo-icon">SHIP</div>
                    <div class="result-header-title">見積処理</div>
                </div>
                <div class="quotation-processing-info">
                    <span class="processing-rfq-no" id="processingRfqNo">-</span>
                    <span class="processing-vendor" id="processingVendor">-</span>
                </div>
            </div>
            <div class="result-header-actions">
                <button class="header-btn back" onclick="handleBackFromProcessing()">見積書管理に戻る</button>
            </div>
        </header>

        <!-- ステップインジケーター -->
        <div class="step-indicator">
            <div class="step-item active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">AI-OCR抽出</div>
                <div class="step-icon">🤖</div>
            </div>
            <div class="step-connector"></div>
            <div class="step-item" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">資産マスタ突き合わせ & 申請紐付け</div>
                <div class="step-icon">🔍</div>
            </div>
        </div>

        <!-- メインコンテンツエリア -->
        <div class="main-content-area">
            <div class="content-wrapper">

                <!-- Step 1: AI-OCR抽出 -->
                <div class="step-content active" id="step1Content">
                    <div class="step-content-header">
                        <h2 class="step-content-title">Step 1: AI-OCR抽出</h2>
                        <p class="step-content-description">見積書PDFから明細情報を自動抽出します</p>
                    </div>

                    <div class="processing-section">
                        <div class="pdf-viewer-section">
                            <div class="section-title">📄 見積書PDF</div>
                            <div class="pdf-viewer" id="pdfViewer">
                                <div class="pdf-placeholder">
                                    <div class="pdf-icon">📑</div>
                                    <div class="pdf-filename" id="pdfFilename">見積書.pdf</div>
                                    <button class="pdf-view-btn" onclick="openPdfPreview()">PDFを開く</button>
                                </div>
                            </div>
                        </div>

                        <div class="ocr-result-section">
                            <div class="section-title">🤖 OCR抽出結果</div>
                            <div class="ocr-status" id="ocrStatus">
                                <button class="ocr-start-btn" onclick="startOcrExtraction()">
                                    <span class="btn-icon">▶</span> OCR抽出を開始
                                </button>
                            </div>
                            <div class="ocr-result-table" id="ocrResultTable" style="display: none;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">No</th>
                                            <th style="width: 300px;">品目名</th>
                                            <th style="width: 80px;">数量</th>
                                            <th style="width: 120px;">単価</th>
                                            <th style="width: 120px;">金額</th>
                                            <th style="width: 150px;">備考</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ocrResultBody">
                                        <!-- OCR結果をJavaScriptで生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="step-btn secondary" onclick="handleBackFromProcessing()">キャンセル</button>
                        <button class="step-btn primary" id="step1NextBtn" onclick="goToStep(2)" disabled>次へ: 資産マスタ突き合わせ & 申請紐付け</button>
                    </div>
                </div>

                <!-- Step 2: 資産マスタ突き合わせ & 申請紐付け -->
                <div class="step-content" id="step2Content">
                    <div class="step-content-header">
                        <h2 class="step-content-title">Step 2: 資産マスタ突き合わせ & 申請紐付け</h2>
                        <p class="step-content-description">抽出した明細を資産マスタの個体管理品目と突き合わせ、申請に紐付けます</p>
                    </div>

                    <div class="matching-section">
                        <div class="matching-summary" id="matchingSummary">
                            <div class="summary-card">
                                <div class="summary-label">抽出明細数</div>
                                <div class="summary-value" id="totalItemsCount">0</div>
                            </div>
                            <div class="summary-card success">
                                <div class="summary-label">確定済み</div>
                                <div class="summary-value" id="confirmedItemsCount">0</div>
                            </div>
                            <div class="summary-card warning">
                                <div class="summary-label">未確定</div>
                                <div class="summary-value" id="unconfirmedItemsCount">0</div>
                            </div>
                        </div>

                        <div class="matching-items-container" id="matchingItemsContainer">
                            <!-- マッチング結果をJavaScriptで生成 -->
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="step-btn secondary" onclick="goToStep(1)">戻る</button>
                        <button class="step-btn success" onclick="completeProcessing()">紐付けを完了</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 資産マスタ選択モーダル -->
    <div class="modal" id="assetMasterSelectModal" onclick="handleAssetMasterModalOutsideClick(event)">
        <div class="modal-content" style="max-width: 800px;">
            <h2 class="modal-title">資産マスタ品目を選択</h2>
            <div class="modal-search">
                <input type="text" id="assetMasterSearch" placeholder="品目名で検索..." onkeyup="filterAssetMaster()">
            </div>
            <div class="modal-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">選択</th>
                            <th style="width: 150px;">品目コード</th>
                            <th style="width: 300px;">品目名</th>
                            <th style="width: 150px;">カテゴリ</th>
                        </tr>
                    </thead>
                    <tbody id="assetMasterModalBody">
                        <!-- 資産マスタリストをJavaScriptで生成 -->
                    </tbody>
                </table>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-button secondary" onclick="closeAssetMasterSelectModal()" style="flex: 1;">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- 申請選択モーダル -->
    <div class="modal" id="applicationSelectModal" onclick="handleApplicationModalOutsideClick(event)">
        <div class="modal-content" style="max-width: 900px;">
            <h2 class="modal-title">紐付け先申請を選択</h2>
            <div class="modal-info">
                <div class="modal-info-label">見積依頼No:</div>
                <div class="modal-info-value" id="modalRfqNo">-</div>
            </div>
            <div class="modal-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">選択</th>
                            <th style="width: 120px;">申請番号</th>
                            <th style="width: 100px;">申請日</th>
                            <th style="width: 120px;">申請種別</th>
                            <th style="width: 250px;">資産情報</th>
                            <th style="width: 80px;">数量</th>
                        </tr>
                    </thead>
                    <tbody id="applicationModalBody">
                        <!-- 申請リストをJavaScriptで生成 -->
                    </tbody>
                </table>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-button secondary" onclick="closeApplicationSelectModal()" style="flex: 1;">キャンセル</button>
            </div>
        </div>
    </div>

</div>
