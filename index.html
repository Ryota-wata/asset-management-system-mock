<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>医療機器管理システム - 資産検索画面</title>

    <!-- Choices.js CSS (外部ライブラリ) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">

    <!-- 共通CSS -->
    <link rel="stylesheet" href="src/css/common.css">

    <!-- モーダルCSS -->
    <link rel="stylesheet" href="src/css/modals.css">

    <!-- 画面固有のCSS -->
    <link rel="stylesheet" href="src/css/screens/login.css">
    <link rel="stylesheet" href="src/css/screens/main.css">
    <link rel="stylesheet" href="src/css/screens/qr.css">
    <link rel="stylesheet" href="src/css/screens/survey.css">
    <link rel="stylesheet" href="src/css/screens/mobile.css">
    <link rel="stylesheet" href="src/css/screens/history.css">
    <link rel="stylesheet" href="src/css/screens/edit.css">
    <link rel="stylesheet" href="src/css/screens/asset-import.css">
    <link rel="stylesheet" href="src/css/screens/asset-matching.css">
    <link rel="stylesheet" href="src/css/screens/data-matching.css">
    <link rel="stylesheet" href="src/css/screens/search-result-simple.css">
    <link rel="stylesheet" href="src/css/screens/asset-detail.css">
    <link rel="stylesheet" href="src/css/screens/application-list.css">
    <link rel="stylesheet" href="src/css/screens/rfq-list.css">
    <link rel="stylesheet" href="src/css/screens/quotation-databox.css">
    <link rel="stylesheet" href="src/css/screens/quotation-processing.css">
    <link rel="stylesheet" href="src/css/screens/individual-management-list.css">
    <link rel="stylesheet" href="src/css/screens/asset-survey-integrated.css">
    <link rel="stylesheet" href="src/css/screens/ship-facility-form.css">

    <!-- Choices.js JS (外部ライブラリ) -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</head>
<body>
    <!-- ログイン画面 -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-logo">MC</div>
            <h1 class="login-title">個体管理システム</h1>

            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="email">メールアドレス</label>
                    <input type="email" id="email" placeholder="メールアドレスを入力してください" autocomplete="username" required>
                </div>

                <div class="form-group">
                    <label for="password">パスワード</label>
                    <input type="password" id="password" placeholder="パスワードを入力してください" autocomplete="current-password" required>
                </div>

                <div class="remember-me">
                    <input type="checkbox" id="remember">
                    <label for="remember">ログイン情報を記憶する</label>
                </div>

                <button type="submit" class="login-button">ログイン</button>
            </form>

            <div class="forgot-password">
                <a href="#" onclick="showPasswordReset(event)">パスワードをお忘れの方</a>
            </div>
        </div>
    </div>

        <!-- メインコンテナ（資産検索画面）は外部ファイルから読み込み -->
        <div id="mainContainer"></div>

        <!-- 個体管理リスト作成モーダル -->
        <div id="listModal"></div>

        <!-- マスター管理モーダル -->
        <div id="masterModal"></div>

        <!-- 病院選択モーダル -->
        <div id="hospitalSelectModal"></div>

        <!-- モバイルカラム選択モーダル -->
        <div id="mobileColumnModal"></div>

        <!-- 登録内容修正画面 -->
        <div id="registrationEditPage"></div>

        <!-- 写真表示モーダル -->
        <div id="photoModal"></div>

        <!-- QRコード新規発行画面 -->
        <div id="qrIssuePage"></div>

        <!-- QRコード印刷画面 -->
        <div id="qrPrintPage"></div>

        <!-- オフライン準備画面 -->
        <div id="offlinePrepPage"></div>

        <!-- 現有資産調査画面 -->
        <div id="surveyPage"></div>

        <!-- 履歴表示画面（レスポンシブ対応） -->
        <div id="historyListPage"></div>

        <!-- 固定資産管理台帳Excelインポート画面 -->
        <div id="assetImportPage"></div>

        <!-- 資産管理台帳と資産マスタ突き合わせ画面 -->
        <div id="assetMatchingPage"></div>

        <!-- データ突合画面 -->
        <div id="dataMatchingPage"></div>

        <!-- 資産検索結果画面 -->
        <div id="searchResultPage"></div>

        <!-- 資産詳細画面 -->
        <div id="assetDetailPage"></div>

        <!-- 申請一覧画面 -->
        <div id="applicationListPage"></div>

        <!-- 見積依頼一覧画面 -->
        <div id="rfqListPage"></div>

        <!-- 現有資産調査統合画面 -->
        <div id="assetSurveyIntegratedPage"></div>

        <!-- SHIP施設マスタ一覧画面 -->
        <div id="shipFacilityMasterPage"></div>

        <!-- SHIP施設マスタ新規作成モーダル -->
        <div id="facilityNewModal"></div>

        <!-- SHIP施設マスタ編集モーダル -->
        <div id="facilityEditModal"></div>

        <!-- SHIP資産マスタ一覧画面 -->
        <div id="shipAssetMasterPage"></div>

        <!-- SHIP資産マスタ新規作成モーダル -->
        <div id="assetNewModal"></div>

        <!-- SHIP資産マスタ編集モーダル -->
        <div id="assetEditModal"></div>

        <!-- 見積明細DataBOX画面 -->
        <div id="quotationDataBoxPage"></div>

        <!-- 見積処理画面 -->
        <div id="quotationProcessingPage"></div>

        <!-- 個体管理リスト原本画面 -->
        <div id="individualManagementListPage"></div>

        <!-- グローバルモーダル：個体登録 -->
        <div class="modal" id="individualRegistrationModal" onclick="handleRegistrationModalOutsideClick(event)">
            <div class="modal-content registration-modal-content">
                <h2 class="modal-title">個体登録</h2>

                <div id="registrationInfo" class="registration-info">
                    <!-- JavaScriptで動的生成 -->
                </div>

                <form id="individualRegistrationForm" onsubmit="handleIndividualRegistrationSubmit(event)">
                    <div class="form-section">
                        <div class="form-group">
                            <label>ドキュメントアップロード（任意）</label>
                            <p class="form-help" style="margin-bottom: 12px;">契約書、納品書、検収書などの関連ドキュメントをアップロードできます</p>

                            <div id="documentUploadList" class="document-upload-list">
                                <!-- 最初のアップロード欄 -->
                                <div class="document-upload-item">
                                    <select class="document-type-select">
                                        <option value="">種別を選択</option>
                                        <option value="契約書">契約書</option>
                                        <option value="納品書">納品書</option>
                                        <option value="検収書">検収書</option>
                                        <option value="保証書">保証書</option>
                                        <option value="取扱説明書">取扱説明書</option>
                                        <option value="その他">その他</option>
                                    </select>
                                    <input type="file" class="document-file-input" accept=".pdf,.jpg,.jpeg,.png">
                                    <button type="button" class="document-remove-btn" onclick="removeDocumentUpload(this)" style="display: none;">削除</button>
                                </div>
                            </div>

                            <button type="button" class="add-document-btn" onclick="addDocumentUpload()">
                                <span>➕</span> ドキュメントを追加
                            </button>
                        </div>
                    </div>

                    <div class="modal-footer-buttons">
                        <button type="button" class="modal-button secondary" onclick="closeIndividualRegistrationModal()">キャンセル</button>
                        <button type="submit" class="modal-button">登録</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- グローバルモーダル：個体詳細 -->
        <div class="modal" id="individualDetailModal" onclick="handleIndividualDetailModalOutsideClick(event)">
            <div class="modal-content" style="max-width: 800px;">
                <h2 class="modal-title">個体詳細情報</h2>

                <div id="individualDetailContent">
                    <!-- JavaScriptで動的生成 -->
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="modal-button secondary" onclick="closeIndividualDetailModal()" style="flex: 1;">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript読み込み（依存関係順） -->
    <script src="src/js/sample-data-generator.js"></script>
    <script src="src/js/master-data-loader.js"></script>
    <script src="src/js/master-data.js"></script>
    <script src="src/js/table-helper.js"></script>
    <script src="src/js/modal-helper.js"></script>
    <!-- 共通ヘルパー関数 -->
    <script src="src/js/common-utils.js"></script>
    <script src="src/js/page-navigation-helper.js"></script>
    <script src="src/js/badge-helper.js"></script>
    <script src="src/js/id-generator-helper.js"></script>
    <script src="src/js/choices-helper.js"></script>
    <script src="src/js/table-edit.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/navigation.js"></script>
    <script src="src/js/modals.js"></script>
    <script src="src/js/qr-management.js"></script>
    <script src="src/js/hospital-select.js"></script>
    <!-- 共通マスタ管理モジュール -->
    <script src="src/js/master-common/DataLoader.js"></script>
    <script src="src/js/master-common/UIHelpers.js"></script>
    <script src="src/js/master-common/TableRenderer.js"></script>
    <script src="src/js/master-common/FilterManager.js"></script>
    <script src="src/js/master-common/SelectionManager.js"></script>
    <script src="src/js/master-common/CRUDManager.js"></script>
    <script src="src/js/master-common/MasterTableManager.js"></script>
    <!-- マスタ管理画面（共通モジュール使用） -->
    <script src="src/js/ship-facility-master.js"></script>
    <script src="src/js/ship-asset-master.js"></script>
    <script src="src/js/asset-survey.js"></script>
    <script src="src/js/asset-survey-integrated.js"></script>
    <script src="src/js/asset-matching.js"></script>
    <script src="src/js/data-matching.js"></script>
    <script src="src/js/search-result-simple.js"></script>
    <script src="src/js/asset-detail.js"></script>
    <script src="src/js/application-list.js"></script>
    <script src="src/js/rfq-list.js"></script>
    <script src="src/js/quotation-databox.js"></script>
    <script src="src/js/quotation-processing.js"></script>
    <script src="src/js/individual-management-list.js"></script>
    <script src="src/js/filters.js"></script>
    <script src="src/js/table-resize.js"></script>
    <script src="src/js/init.js"></script>

    <!-- 画面HTMLの動的読み込みスクリプト -->
    <script>
        // 画面HTMLを読み込む関数
        async function loadScreenHTML(screenId, fileName) {
            try {
                const response = await fetch(`src/screens/${fileName}`);
                const html = await response.text();
                const container = document.getElementById(screenId);
                if (container) {
                    container.outerHTML = html;
                }
            } catch (error) {
                console.error(`Failed to load ${fileName}:`, error);
            }
        }

        // すべての画面HTMLを読み込み（ログイン画面は除く）
        document.addEventListener('DOMContentLoaded', async function() {
            const screens = [
                { id: 'mainContainer', file: 'main.html' },
                { id: 'listModal', file: 'list-modal.html' },
                { id: 'masterModal', file: 'master-modal.html' },
                { id: 'hospitalSelectModal', file: 'hospital-select-modal.html' },
                { id: 'mobileColumnModal', file: 'mobile-column-modal.html' },
                { id: 'registrationEditPage', file: 'registration-edit.html' },
                { id: 'photoModal', file: 'photo-modal.html' },
                { id: 'qrIssuePage', file: 'qr-issue.html' },
                { id: 'qrPrintPage', file: 'qr-print.html' },
                { id: 'offlinePrepPage', file: 'offline-prep.html' },
                { id: 'surveyPage', file: 'survey.html' },
                { id: 'historyListPage', file: 'history.html' },
                { id: 'assetImportPage', file: 'asset-import.html' },
                { id: 'assetMatchingPage', file: 'asset-matching.html' },
                { id: 'dataMatchingPage', file: 'data-matching.html' },
                // { id: 'assetMasterModal', file: 'asset-master-modal.html' }, // 削除: search-result-simple.html内に統合済み
                { id: 'searchResultPage', file: 'search-result-simple.html' },
                { id: 'assetDetailPage', file: 'asset-detail.html' },
                { id: 'applicationListPage', file: 'application-list.html' },
                { id: 'rfqListPage', file: 'rfq-list.html' },
                { id: 'assetSurveyIntegratedPage', file: 'asset-survey-integrated.html' },
                { id: 'shipFacilityMasterPage', file: 'ship-facility-master.html' },
                { id: 'facilityNewModal', file: 'ship-facility-new-modal.html' },
                { id: 'facilityEditModal', file: 'ship-facility-edit-modal.html' },
                { id: 'shipAssetMasterPage', file: 'ship-asset-master.html' },
                { id: 'assetNewModal', file: 'ship-asset-new-modal.html' },
                { id: 'assetEditModal', file: 'ship-asset-edit-modal.html' },
                { id: 'quotationDataBoxPage', file: 'quotation-databox.html' },
                { id: 'quotationProcessingPage', file: 'quotation-processing.html' },
                { id: 'individualManagementListPage', file: 'individual-management-list.html' }
            ];

            // すべての画面を並行して読み込み
            await Promise.all(screens.map(screen => loadScreenHTML(screen.id, screen.file)));

            console.log('All screens loaded successfully');

            // 画面読み込み完了後、Choices.jsを初期化
            if (typeof window.initChoices === 'function') {
                await window.initChoices();
                console.log('Choices.js initialized successfully');
            } else {
                console.error('initChoices function not found');
            }

            // テーブルリサイズ機能を初期化
            if (typeof window.initializeResizableTables === 'function') {
                window.initializeResizableTables();
                console.log('Table resize feature initialized successfully');
            } else {
                console.error('initializeResizableTables function not found');
            }
        });
    </script>
</body>
</html>
